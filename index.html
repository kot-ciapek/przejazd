<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Licytacja miejsc — Częstochowa → Radostków-Kolonia</title>
  <style>
    :root{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;color:#111}
    body{max-width:920px;margin:28px auto;padding:18px}
    h1,h2{margin:8px 0}
    .card{border:1px solid #e6e6e6;border-radius:10px;padding:14px;margin:12px 0;box-shadow:0 2px 6px rgba(0,0,0,0.03)}
    label{display:block;margin:8px 0 4px;font-weight:600}
    input,select,button{padding:8px 10px;border-radius:8px;border:1px solid #ccc;font-size:15px}
    .row{display:flex;gap:10px;align-items:center}
    .spacer{flex:1}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .muted{color:#666;font-size:13px}
    .big{font-size:20px;font-weight:700}
    .countdown{font-weight:700;color:#b22222}
    .copyok{color:green;margin-left:8px}
    .admin-toggle{background:#f3f3f3;border:0}
    .admin-panel{margin-top:10px}
    .btn{background:#0070f3;color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid #0070f3;color:#0070f3}
    .center{text-align:center}
    footer{margin-top:18px;font-size:13px;color:#444}
    .note{font-size:13px;color:#333}
  </style>
</head>
<body>
  <h1>Licytacja miejsc – Częstochowa → Radostków-Kolonia</h1>

  <div class="card">
    <h2>Status licytacji</h2>
    <div class="row">
      <div>Do zakończenia:</div>
      <div class="countdown" id="countdown">ładowanie...</div>
      <div class="spacer"></div>
      <div class="muted">Koniec: <span id="endDateText"></span></div>
    </div>
    <table>
      <thead><tr><th>Miejsce</th><th>Aktualna kwota</th><th>Prowadzący</th></tr></thead>
      <tbody id="seatsTable"></tbody>
    </table>
  </div>

  <div class="card">
    <h2>Wejdź i wygeneruj kod licytacji</h2>
    <label>Twoje imię i nazwisko</label>
    <div class="row">
      <input id="fullname" placeholder="np. Jan Kowalski" />
      <button class="btn" id="saveNameBtn">Zapisz</button>
      <div id="nameSaved" class="muted"></div>
    </div>

    <label>Wybierz miejsce</label>
    <select id="seatSelect"></select>

    <!-- NOWE: pole do wpisania oferty -->
    <label>Twoja oferta (zł)</label>
    <input type="number" id="userBid" min="1" />

    <label>Miejsce odbioru</label>
    <select id="pickupSelect"></select>
    <div id="customKmRow" style="display:none; margin-top:8px">
      <label>Ile km od wybranego miejsca (liczba całkowita)</label>
      <input type="number" id="customKm" min="0" value="0" />
    </div>

    <div style="margin-top:10px" class="row">
      <button class="btn" id="generateBtn">Licytuj (generuj kod)</button>
      <div class="spacer"></div>
      <div class="muted">Dopłata/km: <span id="extraPerKmView"></span> zł</div>
    </div>

    <div id="result" class="card" style="display:none;margin-top:12px">
      <div class="big">Łączna kwota: <span id="totalAmount"></span> zł</div>
      <div style="margin-top:6px">Kod do wysłania SMS: <strong id="shortCode"></strong>
        <button class="btn-ghost" id="copyBtn">Kopiuj</button><span id="copyOK" class="copyok" style="display:none">Skopiowano!</span>
      </div>
      <p style="margin-top:8px">Wyślij powyższy kod SMS-em na numer: <strong id="phoneView"></strong></p>
    </div>
  </div>

  <!-- PANEL ADMINA -->
  <div class="card" id="adminCard" style="display:none">
    <div class="row">
      <h3 style="margin:0">Panel admina (szybka edycja zmiennych)</h3>
      <div class="spacer"></div>
      <button class="admin-toggle" id="toggleAdmin">Pokaż/Ukryj</button>
    </div>
    <div id="adminPanel" class="admin-panel" style="display:none">
      <div class="muted">Edytuj kwoty i nazwy prowadzących (lokalnie).</div>
      <div id="adminSeats"></div>
      <div style="margin-top:8px" class="row">
        <button class="btn" id="saveAdmin">Zapisz zmiany</button>
        <button class="btn-ghost" id="resetConfig">Resetuj</button>
      </div>
    </div>
  </div>

  <footer>
    <div class="muted">Licytacja trwa do 29 sierpnia 2025, 15:00.</div>
  </footer>

  <script>
    const CONFIG = {
      seats: [
        { id: 'seat1', label: 'Miejsce 1', currentBid: 30, leader: 'Anna Nowak' },
        { id: 'seat2', label: 'Miejsce 2', currentBid: 28, leader: 'Piotr K.' },
        { id: 'seat3', label: 'Miejsce 3', currentBid: 25, leader: '—' },
        { id: 'seat4', label: 'Miejsce 4', currentBid: 20, leader: '—' }
      ],
      auctionEndISO: '2025-08-29T15:00:00+02:00',
      phoneNumber: '797318071',
      extraPerKm: 1,
      pickupOptions: [
        { id: 'centrum', label: 'Częstochowa - centrum', extraKm: 0 },
        { id: 'polnoc', label: 'Częstochowa - północ', extraKm: 0 },
        { id: 'dworzec', label: 'Częstochowa - Dworzec PKS', extraKm: 0 },
        { id: 'custom', label: 'Własne miejsce (wpisz ile km)', extraKm: null }
      ]
    };

    const seatsTable = document.getElementById('seatsTable');
    const seatSelect = document.getElementById('seatSelect');
    const pickupSelect = document.getElementById('pickupSelect');
    const customKmRow = document.getElementById('customKmRow');
    const customKmInput = document.getElementById('customKm');
    const extraPerKmView = document.getElementById('extraPerKmView');
    const phoneView = document.getElementById('phoneView');
    const countdownEl = document.getElementById('countdown');
    const endDateText = document.getElementById('endDateText');
    const generateBtn = document.getElementById('generateBtn');
    const adminCard = document.getElementById('adminCard');

    function renderSeatsTable(seats){
      seatsTable.innerHTML = '';
      seats.forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.label}</td><td>${s.currentBid} zł</td><td>${s.leader}</td>`;
        seatsTable.appendChild(tr);
      });
    }

    function populateSelects(seats){
      seatSelect.innerHTML = '';
      seats.forEach(s=>{
        const opt = document.createElement('option');
        opt.value = s.id; opt.textContent = `${s.label} — ${s.currentBid} zł`;
        seatSelect.appendChild(opt);
      });
      pickupSelect.innerHTML = '';
      CONFIG.pickupOptions.forEach(p=>{
        const opt = document.createElement('option'); opt.value = p.id; opt.textContent = p.label;
        pickupSelect.appendChild(opt);
      });
      extraPerKmView.textContent = CONFIG.extraPerKm;
      phoneView.textContent = CONFIG.phoneNumber;
      endDateText.textContent = new Date(CONFIG.auctionEndISO).toLocaleString('pl-PL', {timeZone:'Europe/Warsaw'});
    }

    const auctionEndDate = new Date(CONFIG.auctionEndISO);
    function updateCountdown(){
      const now = new Date();
      const diff = auctionEndDate - now;
      if(diff<=0){
        countdownEl.textContent = 'Licytacja zakończona';
        generateBtn.disabled = true;
        return;
      }
      const d = Math.floor(diff/1000/60/60/24);
      const h = Math.floor(diff/1000/60/60)%24;
      const m = Math.floor(diff/1000/60)%60;
      const s = Math.floor(diff/1000)%60;
      countdownEl.textContent = `${d}d ${h}h ${m}m ${s}s`;
    }
    setInterval(updateCountdown,1000);

    function generateShortCode(fullName, amount){
      const parts = fullName.trim().split(/\s+/);
      if(parts.length===0) return '';
      const first = parts[0];
      const lastInitial = parts.length>1 ? parts[parts.length-1].charAt(0).toUpperCase() : '';
      return `${first}${lastInitial},${amount}zł`;
    }

    generateBtn.addEventListener('click', ()=>{
      if(new Date() > auctionEndDate){ alert("Licytacja zakończona."); return; }
      const fullname = (document.getElementById('fullname').value || '').trim();
      if(!fullname){ alert('Wpisz imię i nazwisko.'); return; }
      const seatId = seatSelect.value;
      const seat = CONFIG.seats.find(s=>s.id===seatId);
      if(!seat){ alert('Nie znaleziono miejsca.'); return; }
      const userBid = Number(document.getElementById('userBid').value);
      if(!userBid || userBid <= seat.currentBid){
        alert(`Twoja oferta musi być większa niż ${seat.currentBid} zł`); return;
      }
      const pickup = pickupSelect.value;
      let extraKm = 0;
      if(pickup==='custom'){ extraKm = parseInt(customKmInput.value)||0; }
      const total = userBid + (extraKm * CONFIG.extraPerKm);
      document.getElementById('totalAmount').textContent = total;
      const code = generateShortCode(fullname, total);
      document.getElementById('shortCode').textContent = code;
      document.getElementById('result').style.display = 'block';
    });

    // admin widoczny tylko dla "tylko przejazd"
    document.getElementById('saveNameBtn').addEventListener('click', ()=>{
      const v = (document.getElementById('fullname').value || '').trim();
      if(!v){ alert('Wpisz imię i nazwisko.'); return; }
      localStorage.setItem('licytacja_fullname', v);
      document.getElementById('nameSaved').textContent = 'Zapisano lokalnie.';
      setTimeout(()=>document.getElementById('nameSaved').textContent='',1500);
      if(v.toLowerCase()==="tylko przejazd"){ adminCard.style.display='block'; }
    });

    pickupSelect.addEventListener('change', ()=>{
      if(pickupSelect.value==='custom') customKmRow.style.display='block'; else customKmRow.style.display='none';
    });

    function loadInitialConfig(){
      renderSeatsTable(CONFIG.seats);
      populateSelects(CONFIG.seats);
      updateCountdown();
      const savedName = localStorage.getItem('licytacja_fullname');
      if(savedName){ 
        document.getElementById('fullname').value = savedName; 
        if(savedName.toLowerCase()==="tylko przejazd"){ adminCard.style.display='block'; }
      }
    }
    loadInitialConfig();
  </script>
</body>
</html>
